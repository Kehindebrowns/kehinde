{"ast":null,"code":"'use strict';\n\nvar _require = require('readable-stream'),\n    Readable = _require.Readable;\n\nvar _require2 = require('../supports'),\n    supportsFileReader = _require2.supportsFileReader;\n\nvar streamFromFileReader = (file, options) => {\n  if (!supportsFileReader) {\n    throw new Error('FileReader DOM API is not supported.');\n  }\n\n  class FileStream extends Readable {\n    constructor(file, options = {}) {\n      super(options);\n      this.file = file;\n      this.offset = options.offset || 0;\n      this.chunkSize = options.chunkSize || 1024 * 1024;\n      this.fileReader = new self.FileReader(file);\n\n      this.fileReader.onloadend = event => {\n        var data = event.target.result;\n\n        if (data.byteLength === 0) {\n          this.push(null);\n        }\n\n        this.push(new Uint8Array(data));\n      };\n\n      this.fileReader.onerror = err => this.destroy(err);\n    }\n\n    _read(size) {\n      var end = this.offset + this.chunkSize;\n      var slice = file.slice(this.offset, end);\n      this.fileReader.readAsArrayBuffer(slice);\n      this.offset = end;\n    }\n\n  }\n\n  return new FileStream(file, options);\n};\n\nmodule.exports = streamFromFileReader;","map":{"version":3,"sources":["/workspace/dtube/node_modules/ipfs-utils/src/streams/stream-from-filereader.js"],"names":["require","Readable","supportsFileReader","streamFromFileReader","file","options","Error","FileStream","constructor","offset","chunkSize","fileReader","self","FileReader","onloadend","event","data","target","result","byteLength","push","Uint8Array","onerror","err","destroy","_read","size","end","slice","readAsArrayBuffer","module","exports"],"mappings":"AAAA;;eACqBA,OAAO,CAAC,iBAAD,C;IAApBC,Q,YAAAA,Q;;gBACuBD,OAAO,CAAC,aAAD,C;IAA9BE,kB,aAAAA,kB;;AAER,IAAMC,oBAAoB,GAAG,CAACC,IAAD,EAAOC,OAAP,KAAmB;AAC9C,MAAI,CAACH,kBAAL,EAAyB;AACvB,UAAM,IAAII,KAAJ,CAAU,sCAAV,CAAN;AACD;;AACD,QAAMC,UAAN,SAAyBN,QAAzB,CAAkC;AAChCO,IAAAA,WAAW,CAAEJ,IAAF,EAAQC,OAAO,GAAG,EAAlB,EAAsB;AAC/B,YAAMA,OAAN;AACA,WAAKD,IAAL,GAAYA,IAAZ;AACA,WAAKK,MAAL,GAAcJ,OAAO,CAACI,MAAR,IAAkB,CAAhC;AACA,WAAKC,SAAL,GAAiBL,OAAO,CAACK,SAAR,IAAqB,OAAO,IAA7C;AACA,WAAKC,UAAL,GAAkB,IAAIC,IAAI,CAACC,UAAT,CAAoBT,IAApB,CAAlB;;AACA,WAAKO,UAAL,CAAgBG,SAAhB,GAA6BC,KAAD,IAAW;AACrC,YAAMC,IAAI,GAAGD,KAAK,CAACE,MAAN,CAAaC,MAA1B;;AACA,YAAIF,IAAI,CAACG,UAAL,KAAoB,CAAxB,EAA2B;AACzB,eAAKC,IAAL,CAAU,IAAV;AACD;;AACD,aAAKA,IAAL,CAAU,IAAIC,UAAJ,CAAeL,IAAf,CAAV;AACD,OAND;;AAOA,WAAKL,UAAL,CAAgBW,OAAhB,GAA2BC,GAAD,IAAS,KAAKC,OAAL,CAAaD,GAAb,CAAnC;AACD;;AAEDE,IAAAA,KAAK,CAAEC,IAAF,EAAQ;AACX,UAAMC,GAAG,GAAG,KAAKlB,MAAL,GAAc,KAAKC,SAA/B;AACA,UAAMkB,KAAK,GAAGxB,IAAI,CAACwB,KAAL,CAAW,KAAKnB,MAAhB,EAAwBkB,GAAxB,CAAd;AACA,WAAKhB,UAAL,CAAgBkB,iBAAhB,CAAkCD,KAAlC;AACA,WAAKnB,MAAL,GAAckB,GAAd;AACD;;AAtB+B;;AAyBlC,SAAO,IAAIpB,UAAJ,CAAeH,IAAf,EAAqBC,OAArB,CAAP;AACD,CA9BD;;AAgCAyB,MAAM,CAACC,OAAP,GAAiB5B,oBAAjB","sourcesContent":["'use strict'\nconst { Readable } = require('readable-stream')\nconst { supportsFileReader } = require('../supports')\n\nconst streamFromFileReader = (file, options) => {\n  if (!supportsFileReader) {\n    throw new Error('FileReader DOM API is not supported.')\n  }\n  class FileStream extends Readable {\n    constructor (file, options = {}) {\n      super(options)\n      this.file = file\n      this.offset = options.offset || 0\n      this.chunkSize = options.chunkSize || 1024 * 1024\n      this.fileReader = new self.FileReader(file)\n      this.fileReader.onloadend = (event) => {\n        const data = event.target.result\n        if (data.byteLength === 0) {\n          this.push(null)\n        }\n        this.push(new Uint8Array(data))\n      }\n      this.fileReader.onerror = (err) => this.destroy(err)\n    }\n\n    _read (size) {\n      const end = this.offset + this.chunkSize\n      const slice = file.slice(this.offset, end)\n      this.fileReader.readAsArrayBuffer(slice)\n      this.offset = end\n    }\n  }\n\n  return new FileStream(file, options)\n}\n\nmodule.exports = streamFromFileReader\n"]},"metadata":{},"sourceType":"script"}